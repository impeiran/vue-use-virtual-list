{"version":3,"file":"index.cjs.js","sources":["../index.ts"],"sourcesContent":["import { ref, Ref, toRefs, onMounted, computed, watch } from 'vue-demi'\n\nexport interface BaseOption {\n  direction?: 'vertical' | 'horizontal';\n  itemHeight?: number;\n  itemWidth?: number;\n  overscan?: number;\n}\n\nexport interface VerticalOption extends BaseOption {\n  direction?: 'vertical';\n  itemHeight: number;\n}\n\nexport interface HorizontalOption extends BaseOption {\n  direction: 'horizontal';\n  itemWidth: number;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction useVirtualList <T = any> (list: Ref<T[]>, options: VerticalOption | HorizontalOption) {\n  const container = ref<HTMLElement>()\n\n  const range = ref({\n    start: 0,\n    end: 0\n  })\n\n  const { itemHeight, itemWidth, overscan, direction } = toRefs(options)\n  const overscanValue = overscan?.value || 0\n  const directionValue = direction?.value || 'vertical'\n\n  const itemSizeValue = (directionValue === 'vertical' ? itemHeight : itemWidth)?.value || 0\n\n  const capacity = computed(() => {\n    const clientSize = directionValue === 'vertical'\n      ? container.value?.clientHeight\n      : container.value?.clientLeft\n\n    return container.value && itemSizeValue\n      ? Math.ceil((clientSize || 0) / itemSizeValue)\n      : 0\n  })\n\n  const getOffset = (scrollDistance: number): number => {\n    return itemSizeValue ? scrollDistance / itemSizeValue : 0\n  }\n\n  const calcListRange = () => {\n    const element = container.value\n    if (element) {\n      const offset = getOffset(\n        directionValue === 'vertical' ? element.scrollTop : element.scrollLeft\n      )\n\n      const from = Math.floor(offset) - overscanValue\n      const to = Math.ceil(offset) + capacity.value + overscanValue + 1\n\n      range.value.start = Math.max(0, from)\n      range.value.end = Math.min(to, list.value.length)\n    }\n  }\n\n  const virtualList = computed(() => {\n    return (list.value as T[])\n      .slice(range.value.start, range.value.end)\n      .map((item, index) => {\n        return {\n          data: item,\n          realIndex: index + range.value.start\n        }\n      })\n  })\n\n  const totalHeight = computed(() => {\n    return list.value.length * itemSizeValue\n  })\n\n  const style = computed(() => {\n    return {\n      marginTop: `${range.value.start * itemSizeValue}px`,\n      marginBottom: `${totalHeight.value - range.value.end * itemSizeValue}px`,\n      overflow: 'auto'\n    }\n  })\n\n  const handleScroll = (e: Event) => {\n    e.preventDefault()\n    calcListRange()\n  }\n\n  watch([list.value], calcListRange)\n\n  onMounted(calcListRange)\n\n  return {\n    container,\n    virtualList,\n    style,\n    refresh: calcListRange,\n    handleScroll\n  }\n}\n\nexport { useVirtualList }\n\nexport default useVirtualList\n"],"names":["ref","toRefs","computed","watch","onMounted"],"mappings":"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"}